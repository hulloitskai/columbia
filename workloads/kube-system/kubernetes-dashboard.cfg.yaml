---

apiVersion: bitnami.com/v1alpha1
kind: SealedSecret

metadata:
  name: kubernetes-dashboard-csrf
  namespace: kube-system

spec:
  encryptedData:
    csrf: AgDyYofnk48CCkMPsJFoD0d2ihVc7dLV5xhnAkJSUOjreATaiJLIxnwG6aGD2Diq3ulJDqyDUhskDyFnD60GwvUTq11Ytw24zK5lv6X7vC9WkLNHFbdiG5wGdfnCVKK44wfVHAy9f21rT4TjApSULBpILf7BveV/ZP7fqc+i7ptRcvXaEykVbZPrGCWmQBROBGSqxzGb7xnoncU0dNS10u/3n9nS/Fon821Y5A3TxKoDtPTLt7O6Sr/yZeeWOH7d9qwdauuHw7G88rJd14hTUDwWvhPpwmN0g8L6CgrxkeLmiEzGREJXejX9RXGB1sc7iQWEvhmWrj3w6EMcMkuk1tMBv9M8RlJKy53OwMYLl5SzQpFUZG711DQiXzS3lE0+2WY5qJr5E5R9nBAgtiQdcmiw7zdV/KeA6QpqFW7n6olLDTbUPj+p4h/KhfzKOXOsN88UoAaSspXi0P0gahQhHqi+229r8jfTzV6ULSXnRgNmctdF/H2LWxr4pnOIjx6Z+XAHUaleXMbxBDSOOTFp0lGFpnsIH/S2HwNc5hAiChWzlyK5I2A52bIzsDvAwbgdDVQ97Bzyy7WJREEYGWv1haA1XZT3/rU/p02TlXnROw3LN/rZ5vwOeFlrJoSxrTremKPqcXfbV9gLfiMWYvt+i/ot3+AlUy0HbJrhHYxpScHGInYCsBbaxFpXzyGafSIf5Ti8DPfka7kXzG2m1VYf1FaKFSgoM/7cSgly4+B11s/cBw==
  template:
    metadata:
      name: kubernetes-dashboard-csrf
      namespace: kube-system

---

apiVersion: v1
kind: ServiceAccount

metadata:
  name: kubernetes-dashboard
  namespace: kube-system
  labels:
    k8s-app: kubernetes-dashboard

---

apiVersion: rbac.authorization.k8s.io/v1
kind: Role

metadata:
  name: kubernetes-dashboard-minimal
  namespace: kube-system

rules:
  # Allow Dashboard to create 'kubernetes-dashboard-key-holder' secret.
  - apiGroups: [""]
    resources: ["secrets"]
    verbs: ["create"]

  # Allow Dashboard to create 'kubernetes-dashboard-settings' config map.
  - apiGroups: [""]
    resources: ["configmaps"]
    verbs: ["create"]

  # Allow Dashboard to get, update and delete Dashboard exclusive secrets.
  - apiGroups: [""]
    resources: ["secrets"]
    resourceNames: ["kubernetes-dashboard-key-holder", "kubernetes-dashboard-certs", "kubernetes-dashboard-csrf"]
    verbs: ["get", "update", "delete"]

  # Allow Dashboard to get and update 'kubernetes-dashboard-settings' config map.
  - apiGroups: [""]
    resources: ["configmaps"]
    resourceNames: ["kubernetes-dashboard-settings"]
    verbs: ["get", "update"]

  # Allow Dashboard to get metrics from heapster.
  - apiGroups: [""]
    resources: ["services"]
    resourceNames: ["heapster"]
    verbs: ["proxy"]
  - apiGroups: [""]
    resources: ["services/proxy"]
    resourceNames: ["heapster", "http:heapster:", "https:heapster:"]
    verbs: ["get"]

---

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding

metadata:
  name: kubernetes-dashboard-minimal
  namespace: kube-system

roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: kubernetes-dashboard-minimal

subjects:
  - kind: ServiceAccount
    name: kubernetes-dashboard
    namespace: kube-system
